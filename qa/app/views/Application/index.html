#{extends 'main.html' /}
#{set title:'Home' /}

#{if lastActivity}
	<div class="questions">
	<h3>Newest activity:</h3>
   	<div class="question">
		<div class="question-author">
			#{ifnot models.User.find("byEmail", lastActivity.author.fullname).first()==null}
				<div class="avatar"><img src="${models.User.find("byEmail", lastActivity.author.fullname).first().avatarPath}" width="62" height="62"/></div>
			#{/ifnot}
				<a href="@{Users.showProfile(lastActivity.author.id)}">${lastActivity.author.fullname}</a>
					<div class="question-date">
						${lastActivity.timestamp}
					</div>
					<div class="metadata" id="question-metadata">
						#{secure.check 'user'}
						#{if isconnected && lastActivity instanceof models.Question} 
							#{if !user.isFollowing(lastActivity) && !user.isAbleToChoose(lastActivity.id)}
								<a class="button" href="@{Users.followQuestion(lastActivity.id)}">follow</a>
							#{/if}
							
							#{if isconnected && user.isAbleToChoose(lastActivity.id)}
								<a class="button" href="@{Users.showEdit(lastActivity.id, 0)}">edit</a>
							#{/if}
						#{/if}
						#{/secure.check}
					</div>
				</div>
				<div class="question-main">
					#{if lastActivity.checkInstance()}
					<div class="question-title">
						<a href="@{Application.show(lastActivity.id)}">${lastActivity.getTitle()}</a>
					</div>
					<div class="question-content">
						${lastActivity.content.nl2br()}
					</div>
				<div class="question-answer">
					#{ifnot lastActivity.answers.isEmpty()}
						(last answered by ${lastActivity.answers.get(lastActivity.answers.size()-1).author.fullname})
					#{/ifnot}
			</div>
			#{/if}
			#{else}
				${lastActivity.timestamp} a new answer was added to a <a href = "@{Application.show(lastActivity.question.id)}">question</a> by
			#{/else}
			#{if lastActivity.tags.size() > 0}
				Tags:
				#{list items:lastActivity.tags, as:'tag'}
    				<a href="@{Application.tagged(tag)}">${tag}</a>${tag_isLast ? '' : ', '}
				#{/list}
			#{/if}
		</div>
     </div>

	</div>
    
	#{if questions.size() > 1}
		<div class="questions"> 
			<h3>All questions on A4Q</h3>
			
			#{list items:questions, as:'question'}
				<div class="question">
					<div class="voting">
						<div class="vote-curr">
							${question.voting()}
						</div>
						#{secure.check 'user'}
								<div class="vote-up-down">
									<a class="vote-up" href="@{Users.voteForQuestion(question.id, true)}"></a>
									<a class="vote-down" href="@{Users.voteForQuestion(question.id, false)}"></a>
								</div>
						#{/secure.check}
					</div>
					<div class="question-author">
						#{ifnot models.User.find("byEmail", question.author.fullname).first()==null}
							<div class="avatar"><img src="${models.User.find("byEmail", question.author.fullname).first().avatarPath}" width="62" height="62"/></div>
						#{/ifnot}
						<a href="@{Users.showProfile(question.author.id)}">${question.author.fullname}</a>
						<div class="question-date">
							${question.timestamp}
						</div>
						
						<div class="metadata" id="question-metadata">
							#{secure.check 'user'}
							#{if isconnected}
								#{if !user.isFollowing(question) && !user.isAbleToChoose(question.id)}
									<a class="button" href="@{Users.followQuestion(question.id)}">follow</a>
								#{/if}
							
								#{if isconnected && user.isAbleToChoose(question.id)}
									<a class="button" href="@{Users.showEdit(question.id, 0)}">edit</a>
								#{/if}
							#{/if}
							#{/secure.check}
						</div>
						
					</div>
					<div class="question-main">
						<div class="question-title">
							<a href="@{Application.show(question.id)}">${question.getTitle()}</a>
						</div>
						<div class="question-content">
							${question.content.nl2br()}
						</div>
						<div class="metadata" id="question-metadata">
							#{if question.attachmentPath != null}
								<a class="button" href="${question.attachmentPath}"> attachment</a>
							#{/if}
						</div>
						<div class="question-answer">
							#{ifnot question.answers.isEmpty()}
								(last answered by ${question.answers.get(question.answers.size()-1).author.fullname})
							#{/ifnot}
							#{if question.tags.size() > 0}
								<br>
								Tags:
								#{list items:question.tags, as:'tag'}
    								<a href="@{Application.tagged(tag)}">${tag}</a>${tag_isLast ? '' : ', '}
								#{/list}
							#{/if}
						</div>
					</div>
                </div>
         	#{/list}
    	</div>    
	#{/if}
#{/if}
 
#{else}
    <div class="empty">
        There is currently nothing to answer here.
    </div>
#{/else}


