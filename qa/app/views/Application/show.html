#{extends 'main.html' /} 
#{set title:'Show question' /} 


#{if question.previous()}
<div class="link" id="previous">
	<a href="@{Application.show(question.previous().id)}"> Previous question.</a>
</div>
#{/if} 
#{if question.next()}
<div class="link" id="next">
	<a href="@{Application.show(question.next().id)}"> Next question.</a>
</div>
#{/if}
<br>


<div class="question">
	Question:
    <div class="question-metadata">
        <span class="question-author">by ${question.author.fullname}</span>
        <span class="question-date">${question.timestamp}</span>
        <span class="question-voting"> Voting: ${question.voting}</span>
			#{secure.check 'user'}       	
        		       
        		   
         				#{if abletovote}
         				         	#{form @Users.voteForQuestion(question.id, models.User.find("byEmail", controllers.Security.connected()).first())}
         				         			<select name="vote">
         				         				<option>Vote up</option>
         										<option>Vote down</option>
        			 						</select>
        			 					<input type="submit" name="vote" value="vote">
        			 				#{/form}
        			 	#{/if}
			#{/secure.check}
    </div>
    <div class="question-content">
    	<br>
    	${question.content.nl2br()}
    </div>
</div>
<br>
<div>
	Answers to this question:
</div>

<br>
#{if question.answers.size() < 1}
<div>
	There is no answer.
</div>
#{/if}

#{else}
	#{list items:question.answers, as:'answer'}
	<div class="answers">
		<p>
   		<div class="answer-metadata">
        	<span class="answer-author">by ${answer.author.fullname},</span>
        	<span class="answer-date">${answer.timestamp}</span>
        	<span class="answer-voting"> Voting: ${answer.voting}</span>
        	
        	#{secure.check 'user'}       	
        		      
         				#{if !answer.hasVoted(models.User.find("byEmail", controllers.Security.connected()).first()) && !answer.author.fullname.equals(models.User.find("byEmail", controllers.Security.connected()).first().fullname)}
         				         	#{form @Users.voteForAnswer(question.id, answer.id, models.User.find("byEmail", controllers.Security.connected()).first())}
         				         			<select name="vote">
         				         				<option>Vote up</option>
         										<option>Vote down</option>
        			 						</select>
        			 					<input type="submit" name="vote" value="vote">
        			 				#{/form}
        			 	#{/if}
        			 	
        			 	#{if validdate && abletochoose}
        			 	#{form @Users.chooseBestAnswer(answer.id)}
        			 		<input type="submit" name="best answer" value="best answer">
        			 	#{/form}
        			 	#{/if}
        			 	
        			 	#{if answer.best && !validdate}
        			 		This is the best Answser
        			 	#{/if}
        			 	
			#{/secure.check}
        	
        	
    	</div>
   		<div class="answer-content">
         	${answer.content.escape().nl2br()}
    	</div>
    	</p>
	</div>
	#{/list}
#{/else}


<p><br></p>
#{secure.check 'user'}
<div class="form" id="answerForm">
	#{form @Users.answerQuestion(question.id)}
		#{ifErrors}
    	   	<p class="error">
       	    	All fields are required!
      	  	</p>
 	    #{/ifErrors}
    		<p>
        		<label for="author">Your fullname: </label>
        		<input type="text" name="author" id="user" value="${models.User.find("byEmail", controllers.Security.connected()).first().fullname}" readonly/>
    		</p>
    		<p>
        		<label for="content">Your answer: </label>
        		<br>
        		<textarea name="content" id="content"></textarea>
    		</p>
    		<p>
        		<input type="submit" value="Submit your answer" />
    		</p>
	#{/form}
</div>
#{/ secure.check}

 
#{if flash.success}
	<br>
    <p class="success">${flash.success}</p>
#{/if}


