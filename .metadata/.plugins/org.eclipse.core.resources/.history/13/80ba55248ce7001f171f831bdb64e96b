#{extends 'profileMain.html' /}
#{set title:'User Profile' /}

#{secure.check 'user'}
<div class="form" id="userForm">
#{form @Users.changeProfile()}
<p>
    <label for="author">Fullname: </label>
	<input type="text" fullname="author" id="user-inp" value="${models.User.find("byEmail", controllers.Security.connected()).first().fullname}" readonly/>
    
<p>
	<label for="author">Email: </label>
	<input type="text" fullname="author" id="user-inp" value="${models.User.find("byEmail", controllers.Security.connected()).first().email}" readonly/>

   
<p>
	#{field 'birthday'}
		<label for="author">Birthday: </label>
		<input type="text" name="${field.name}" email="author" id="user-inp" value="${models.User.find("byEmail", controllers.Security.connected()).first().getBirthday()}" />
		<label for="content"></label>
	#{/field}
	

<p>
	<label for="author">Age: </label>
	<input type="text" fullname="author" id="user-inp" value="${models.User.find("byEmail", controllers.Security.connected()).first().calculateAge()}" readonly/>

<p>
	#{field 'website'}
		<label for="author">Website: </label>
		<input type="text" name="${field.name}" email="author" id="user-inp" value="${models.User.find("byEmail", controllers.Security.connected()).first().website}" />
		<label for="content"></label>
	#{/field}

<p>
	#{field 'work'}
		<label for="author">Work: </label>
		<input type="text" name="${field.name}" email="author" id="user-inp" value="${models.User.find("byEmail", controllers.Security.connected()).first().work}" />
		<label for="content"></label>
	#{/field}

<p>
	#{field 'languages'}
		<label for="author">Programming Languages: </label>
		<input type="text" name="${field.name}" email="author" id="user-inp" value="${models.User.find("byEmail", controllers.Security.connected()).first().favoriteLanguages}" />
		<label for="content"></label>
	#{/field}

<p>
	#{field 'aboutMe'}
		<label for="aboutMe">About Me: </label>
	<br>
		<textarea name="${field.name}">${models.User.find("byEmail", controllers.Security.connected()).first().aboutMe}</textarea>
	#{/field}
	
<p>
	<input type="submit" value="Update"/>


#{/form}

<hr>

<p>
<label> Upload an Avatar:
<form action="@{Users.uploadAvatar()}" method="POST" enctype="multipart/form-data">
	<table style="padding-left: 60px">
	<input type="file" id="avatar" name="avatar" />
	<input type="submit" value="Upload" />
	</table>
</form> 

<p>

#{form @Users.updateAvatarPath()}
	#{field 'URL'}
		<label for="author">or enter an URL:
		<p>
		<input type="text" name="${field.name}" email="author" id="user-inp"/>
		<label for="content">
		<input type="submit" value="Submit" />
	#{/field}

#{/form}
#{/ secure.check}

<p>
	<h2>Activities</h2>
			#{list items:activities, as:'activity'}
				<div class="activity">
					#{if activity.checkInstance()}
						${activity.timestamp}, ${user.fullname} wrote a new <a href = "@{Application.show(activity.id)}">question</a>.
					#{/if}
					#{else}
					 ${activity.timestamp}, ${user.fullname} wrote a answer to the  <a href = "@{Application.show(activity.question.id)}"> question</a> from ${activity.author.fullname}
					#{/else}
				</div>
     #{/list}
    


<h2>Reputation Graph</h2>

<div id="graph">
	<div id="graphcanvas" style="width:600px;height:300px"></div>
</div>

<script id="source" language="javascript" type="text/javascript">

$(function () {
	loadGraph();
	});

function loadGraph() {
			if(!$("#graph")[0].loaded) {
			jQuery.getJSON( self.location, displayGraph);
			$("#graph")[0].loaded = true;
		}
	}
	
function displayGraph(data, status) {
		var points = [];
		alert("geht hier durch");
	for(i in data) {
		alert("geht hier durch");
		alert(data[i].time);
		points.push([data[i].time, data[i].value]);
	}	

    $.plot($("#graphcanvas"), [
        {
            data: points,
            lines: { show: true, steps: true },
            points: { show: false }
        }
    ], {
     xaxis: {
     mode: "time"
     }
    } );
 }

</script>


#{if flash.success}
<br>
	<p class="success">${flash.success}</p>
#{/if}